define((function(){"use strict";class e{url;opts;ws=null;_reconnectTimer=null;_manualClose=!1;_repeat=1/0;_lockReconnect=!1;_heartbeatTimer=null;_pongTimer=null;constructor(e,t){this.url=e,this.opts={isReconnect:t?.isReconnect||!0,onMessage:t?.onMessage,onError:t?.onError,close:t?.close,reconnectTimeout:t?.reconnectTimeout||300,reconnectRepeat:t?.reconnectRepeat||1/0,isHeartbeat:t?.isHeartbeat||!0,pingMsg:t?.pingMsg||"ping",pingTimeout:t?.pingTimeout||3e4,pongTimeout:t?.pongTimeout||300},this._init()}_init=()=>{this._reconnectTimer=null,this._manualClose=!1,this._repeat=0,this._lockReconnect=!1,this._heartbeatTimer=null,this._pongTimer=null,this._resetReconnect(),this._resetHeartbeat(),this._connect(),this._onopen(),this._onmessage(),this._onerror(),this._onclose()};_connect=()=>{this.ws=new WebSocket(this.url)};_onopen=()=>{this.ws&&(this.ws.onopen=()=>{this._checkHeartbeat()})};_onmessage=()=>{this.ws&&(this.ws.onmessage=e=>{this._checkHeartbeat(),"function"==typeof this.opts.onMessage&&this.opts.onMessage(e)})};_onerror=()=>{this.ws&&(this.ws.onerror=e=>{this._reconnect(),"function"==typeof this.opts.onError&&this.opts.onError(e)})};_onclose=()=>{this.ws&&(this.ws.onclose=e=>{this.opts.isReconnect&&!this._manualClose?this._reconnect():this.ws?.close(),"function"==typeof this.opts.close&&this.opts.close(e)})};_reconnect=()=>{this._resetHeartbeat(),!this.ws||!this.opts.isReconnect||this._lockReconnect||Number(this.opts?.reconnectRepeat)<=this._repeat||this._manualClose||(this._lockReconnect=!0,this._repeat++,this._reconnectTimer=setTimeout((()=>{this._init(),this._lockReconnect=!1}),this.opts?.reconnectTimeout))};_resetReconnect=()=>{this._reconnectTimer&&clearTimeout(this._reconnectTimer)};_checkHeartbeat=()=>{this._resetHeartbeat(),this._startHeartbeat()};_resetHeartbeat=()=>{this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._pongTimer&&clearTimeout(this._pongTimer)};_startHeartbeat=()=>{this.opts.isHeartbeat&&this.opts.isReconnect&&(this._heartbeatTimer=setTimeout((()=>{this.ws&&this.ws.readyState===WebSocket.OPEN?this.ws.send(this.opts.pingMsg):this.ws?.close(),this._pongTimer=setTimeout((()=>{this.ws?.close()}),this.opts.pongTimeout)}),this.opts.pingTimeout))};sendMessage=e=>{if(this.ws){if(this.ws.readyState===WebSocket.CONNECTING){const t=setInterval((()=>{this.ws&&(this.ws.readyState===WebSocket.OPEN&&this.ws?.send(e),this.ws.readyState!==WebSocket.CONNECTING&&clearInterval(t))}),100)}this.ws.readyState===WebSocket.OPEN&&this.ws?.send(e)}};close=()=>{this._manualClose=!0,this.ws?.close()}}return"undefined"!=typeof window&&(window.Socket=e),e}));
